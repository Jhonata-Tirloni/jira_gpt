{% extends "base.html" %}
{% block content %}
<div class="container">
    <div class="columns">
        <div class="column is-two-fifths">
            <div class="box" style="background-color: white;">
                <img src="../static/jira_gpt.png" width="400" style="display: block; margin-left: auto; margin-right: auto;"/>
                <div class="field">
                    <div class="control">
                        <textarea id="prompt" class="textarea is-large" name="text" rows="9" placeholder="Escreva sua solicitação aqui!" style="resize: none;">
                        </textarea>
                    </div>
                </div>
                <button id="send_gpt" class="button is-responsive is-outlined is-block is-info is-large is-fullwidth">
                    Gerar descrição
                </button>
            </div>
        </div>
        <div class="column is-three-fifths">
            <div class="box" style="background-color: white;">
                <div class="field">
                    <div class="control">
                        <img id="loading" hidden src="../static/typing_loading.gif" width="76" style="position: absolute; z-index: 99999; margin-top: 25rem;"/>
                        <textarea id="response_gpt" class="textarea is-large" disabled name="text" rows="12" style="resize: none;">
                        </textarea>
                        <b>
                            <p style="text-align: center;">
                                Caso o texto se adeque ao que precisa, clique no botão "Enviar Card" abaixo, para finalizar. <br/>Do contrário, reescreva e gere a descrição novamente.
                            </p>
                        </b>
                        <button id="send_jira" class="button is-responsive is-block is-info is-large is-fullwidth has-text-weight-bold" style="background-color: #3FA110;">
                            Criar card
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type=text/javascript>
    document.getElementById("send_gpt").addEventListener("click", function() {
        var promptValue = document.getElementById("prompt").value;

        $("#response_gpt").val('');

        $('#loading').show();

        $.ajax({
            url: '/gerar_descricao',
            type: 'post',
            contentType: 'application/json',
            data: JSON.stringify({prompt: promptValue}),
            success: function(response){
                $("#response_gpt").val(response.response);
            },
            complete: function(){
                $('#loading').hide();
            }
        });
    });

    document.getElementById("send_jira").addEventListener("click", function(){
        $('#loading').show();

        const success_message_pone = "Card criado com sucesso! Seu número é: "
        const success_message_ptwo = ". Anote ou copie para ter controle! Você também pode acompanhar direto no board do time."
        
        $.ajax({
            url: '/create_jira_task',
            type: 'GET',
            dataType: 'json',
            success: function(response){
                Toastify({
                    text: success_message_pone + response.response + success_message_ptwo,
                    duration: 120000,
                    destination: "#",
                    newWindow: false,
                    close: true,
                    gravity: "top",
                    position: "center",
                    stopOnFocus: true,
                    style: {
                        background: "linear-gradient(to right, #00b09b, #3FA110)"
                    }
                }).showToast();
            },
            complete: function(){
                $('#loading').hide();
            }
        });
    });
</script>
{% endblock %}